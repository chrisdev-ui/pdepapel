name: Daily Store Operations (Scheduler)

on:
  schedule:
    - cron: "0 9 * * *" # Every day at 9:00 AM UTC (4:00 AM Bogota Time)
  workflow_dispatch: # Allow manual trigger for testing

jobs:
  run-daily-tasks:
    runs-on: ubuntu-latest
    steps:
      - name: Notify System Starting
        run: echo "Starting daily background tasks..."

      - name: Trigger Automatic Customer Reactivation
        run: |
          curl -f -X POST "${{ secrets.PRODUCTION_URL }}/api/${{ secrets.STORE_ID }}/scheduler/auto-reactivation" \
            -H "Authorization: Bearer ${{ secrets.SCHEDULER_SECRET }}"

      - name: Trigger Bank Transfers Cancellation
        run: |
          curl -f -X POST "${{ secrets.PRODUCTION_URL }}/api/${{ secrets.STORE_ID }}/scheduler/bank-transfers" \
            -H "Authorization: Bearer ${{ secrets.SCHEDULER_SECRET }}"

      - name: Trigger Weekly ABC Classification Recalculation
        # Run only on Sundays (cron '0 9 * * 0' would be ideal, but we can just let it run daily or check the day)
        # For simplicity in a single daily workflow, we can run it every day. It's a fast memory calculation.
        run: |
          curl -f -X POST "${{ secrets.PRODUCTION_URL }}/api/${{ secrets.STORE_ID }}/products/abc-classification" \
            -H "Authorization: Bearer ${{ secrets.SCHEDULER_SECRET }}"
